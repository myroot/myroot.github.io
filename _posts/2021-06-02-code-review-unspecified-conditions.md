---
title: "[코드리뷰사례] 명세되지 않은 조건에 의한 행위 변화"
layout: post
comments: true
---
코드 리뷰 사례를 공유하기 위하여 글을 작성하였습니다. 
이번 사례는 명세되지 않은 조건에 의해서 API동작이 변경되는 상황에 대해 리뷰한 사례입니다.


### 문제 코드
![image](https://github.sec.samsung.net/storage/user/376/files/4575f600-c221-11eb-917a-f23b44b5301f)
Pressed 효과가 나타나지 않는 이슈를 수정하는 PR로
Property를 설정하는 순서를 바꿈으로서 동작이 달라지는 구현이 존재하였습니다.

### 문제 코드에 관한 설명
 UI컴포넌트 상태에 따라 색상을 선택하는 클래스인데, 
 Property setter 구현이 내부적으로 Collection에 값을 넣고 있고, 값을 선택할때, Collection으로부터 순차 검색을 하고 있었습니다.
 그런데, 중첩 상태가 존재 할 수 있게 되면서, Property를 설정하는 순서가 동작에 영향을 미치고 있었습니다.

### 해당 코드의 문제점
 해당 코드의 인터페이스만 봐서는 절대 Property설정 순서가 결과에 영향을 미친다고 판단할 수 없습니다. 그리고, Property설정은 각 property별로 독립적이어야 하는데, 위의 구현은 이전에 설정한 Property 설정 값에 따라 결과가 바뀌는 독립적이지 못한 구현이 발생하고 있습니다.
  이는 의도하지 않은 side effect을 발생시키는 코드로 구현을 알지 못하는 경우 절대 발견할 수 없는 버그를 유발시킬수 있으므로 좋지 않은 코드입니다.
 개발자는 모두 인터페이스에만 의존하여 개발해야하며, 그래야지만 구현의 변경으로부터 자유로울 수 있습니다. 그런데, 지금과 같이 구현에 의존해야 한다면, API가 바뀌지 않았음에도 구현이 바뀔때마다, 해당 API를 사용하는 모든 코드를 확인해야하는 문제가 발생하게 됩니다. 따라서, 모든 구현은 코드로서 명시되지 않은 제약을 만들면 안되며, API를 사용하는 곳 또한 코드에 명시되지 않은 조건에 의존하여 코드를 작성하면 안됩니다.

### 대안으로 재시한 방법
 명시적으로 우선순위를 노출하고, 이를 API사용자에게 설정하도록 하거나 또는 상태별로 우선순위를 부여하여 어떤 순서로 설정되는 상관 없이 우선순위가 높은 상태를 선택하도록 가이드하였습니다.

### 결론
 모든 구현은 계약된 사항에만 의존해야 합니다. 만약 이런 원칙이 지켜지지 않는다면, 인터페이스를 통한 구현의 다형성 및 이를 통한 코드 변경의 지역성(locality)의 효과를 얻을 수 없게 되어, 한곳에서 발생하는 변경이 모든 코드에 영향을 미치게 됩니다. 따라서 우리는 필요한 제약이 있는 경우는 이를 코드로서 명확하게 제약성을 부여해야 합니다.